import{r as o,j as e}from"./index-Qswdb9Jc.js";import{a as S}from"./index-NIGUFBhG.js";function y({setLogged:c}){const[t,i]=o.useState(""),[d,p]=o.useState(""),[l,a]=o.useState(!1),[u,n]=o.useState(!1),[g,h]=o.useState(!1),f=async()=>{a(!0);try{const m=(await S.post("https://auth.dnjs.lk/api/login",{email:t,password:d})).data.access_token;g?(localStorage.setItem("access_token",m),localStorage.setItem("signedin","true")):(sessionStorage.setItem("access_token",m),sessionStorage.setItem("signedin","true")),c(!0),n(!1),localStorage.setItem("access_token",m),console.log(m)}catch(s){a(!1),console.log("Error:",s.response?.data||s.message),n("Login in unsuccessful"),c(!1)}finally{a(!1)}};return o.useEffect(()=>{const s=localStorage.getItem("rememberMe");s!==null&&h(s==="true")},[]),e.jsxs("div",{children:[e.jsx("input",{type:"text",placeholder:"Enter email",value:t,onChange:s=>i(s.target.value),disabled:l}),e.jsx("br",{}),e.jsx("input",{type:"password",placeholder:"Enter password",value:d,onChange:s=>p(s.target.value),disabled:l}),e.jsx("br",{}),e.jsx("p",{onChange:f,children:u}),e.jsxs("span",{children:[e.jsx("input",{type:"checkbox",checked:g,onChange:()=>{const s=!g;h(s),localStorage.setItem("rememberMe",s)}}),"Keep me logged in"]}),e.jsx("br",{}),e.jsx("button",{onClick:f,style:{margin:"10px",color:"cyan"},disabled:l,children:l?"Loging In...":"Login"})]})}function I({setLogged:c}){const[t,i]=o.useState(null),[d,p]=o.useState(null),[l,a]=o.useState(!1),[u,n]=o.useState(""),[g,h]=o.useState(""),[f,s]=o.useState(!1),[m,j]=o.useState(!1);o.useEffect(()=>{const x=localStorage.getItem("access_token")||sessionStorage.getItem("access_token");S.get("https://auth.dnjs.lk/api/user",{headers:{Authorization:`Bearer ${x}`}}).then(r=>{i(r.data),console.log(r.data)}).catch(r=>{p("Failed to fetch data properly"),console.error(r)})},[]);const b=async()=>{const x=localStorage.getItem("access_token")||sessionStorage.getItem("access_token");a(!0);try{await S.post("https://auth.dnjs.lk/api/logout",{},{headers:{Authorization:`Bearer ${x}`}}),localStorage.removeItem("access_token"),localStorage.removeItem("signedin"),sessionStorage.removeItem("access_token"),sessionStorage.removeItem("signedin"),c(!1),console.log("Logout Successful")}catch{console.error("Logout failed")}finally{a(!0)}},v=async()=>{const x=localStorage.getItem("access_token")||sessionStorage.getItem("access_token");s(!0),j(!1);const r={name:u?.trim()===""?t.name:u,description:g??t.description};try{await S.put("https://auth.dnjs.lk/api/user",r,{headers:{Authorization:`Bearer ${x}`}}),s(!0),i(k=>({...k,name:r.name,description:r.description}))}catch(k){console.error("Error:",k)}finally{s(!1)}};return o.useEffect(()=>{t&&(n(t.name||""),h(t.description||""))},[t]),e.jsx("div",{children:m?e.jsx(E,{name:u,setName:n,description:g,setDescription:h,handleSave:v,saving:f,back:()=>j(!1)}):e.jsxs("div",{children:[e.jsx("h3",{children:"You have now logged in!"}),e.jsxs("p",{children:["Name: ",t?.name]}),e.jsxs("p",{children:["Email: ",t?.email]}),e.jsx("img",{src:t?.avatar,alt:"User Avatar",style:{borderRadius:"50%",width:"100px",height:"100px",objectFit:"cover"}}),e.jsxs("p",{children:["Subscribed: ",t?.subscribed?"Yes":"No"]}),e.jsxs("p",{children:["Description: ",t?.description]}),e.jsx("button",{onClick:()=>j(!0),style:{margin:"10px",color:"cyan"},children:"Edit Profile"}),e.jsx("br",{}),e.jsx("button",{onClick:b,disabled:l,style:{margin:"10px",color:"red"},children:"Log out"})]})})}function E(c){const{name:t,setName:i,description:d,setDescription:p,handleSave:l,loading:a,back:u}=c;return e.jsxs("div",{children:[e.jsx("h4",{children:"Edit Your Profile"}),e.jsx("input",{value:t,onChange:n=>i(n.target.value),type:"text",placeholder:"Change Name"}),e.jsx("br",{}),e.jsx("input",{value:d,onChange:n=>p(n.target.value),type:"text",placeholder:"Change Description",style:{margin:"10px"}}),e.jsx("br",{}),e.jsx("button",{onClick:l,disabled:a,style:{margin:"10px",color:"chartreuse"},children:a?"Saving...":"Save"}),e.jsx("button",{onClick:u,style:{margin:"10px",color:"cyan"},children:"Go back"})]})}function w(){const[c,t]=o.useState(!1);return o.useEffect(()=>{const i=localStorage.getItem("access_token")||sessionStorage.getItem("access_token"),d=localStorage.getItem("signedin")||sessionStorage.getItem("signedin");t(!!(i&&d==="true"))},[]),c?e.jsx(I,{setLogged:t}):e.jsx(y,{setLogged:t})}export{w as default};
