import{r as s,j as o}from"./index-Cusg-GZ3.js";const C=86.4,O=45.4,d={},_=3,oe=.375,c=35,p=290,L=[{x:66.8,y:16,w:52,h:92},{x:188.8,y:16,w:48,h:94.8},{x:7,y:192.2,w:52.6,h:136.4},{x:425.2,y:19.8,w:60.1,h:137.3}];let ae=0;const ie=2,ce=.2,m=3;function ue(){const E=s.useRef(0),[U,z]=s.useState(0),w=s.useRef(null),k=s.useRef(null),[J,S]=s.useState(null),i=s.useRef([]),f=s.useRef(360),[X,T]=s.useState(!1),[K,P]=s.useState(0),[a,g]=s.useState("start"),n=s.useRef((k.current?.offsetWidth??0-O)/2),q=s.useRef("idle"),Q=()=>{DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(e=>{g(e==="granted"?"playing":"error")}):g("playing")};s.useEffect(()=>{let e=null,j=performance.now(),l=w.current;if(!l||!k.current)return;let u=l.offsetWidth;const F=(p-c)/m,Z=c+Math.floor(m/2)*F+F/2;n.current=Z,l.style.left=n.current-u/2+"px";let H=0,ee=1e3;window.onkeydown=r=>{a==="playing"&&((r.key==="ArrowLeft"||r.key==="ArrowRight")&&r.preventDefault(),d[r.key]=!0)},window.onkeyup=r=>{a==="playing"&&((r.key==="ArrowLeft"||r.key==="ArrowRight")&&r.preventDefault(),d[r.key]=!1)};const I=r=>{e=requestAnimationFrame(I);const N=r-j;if(E.current+=oe*N,j=r,a==="playing"&&(d.ArrowLeft||q.current==="left"?(n.current=Math.max(c+u/2,n.current-_),S("left"),l.style.transform="rotate(-15deg)"):d.ArrowRight||q.current==="right"?(n.current=Math.min(p-u/2,n.current+_),S("right"),l.style.transform="rotate(15deg)"):(S("idle"),l.style.transform="rotate(0deg)"),i.current.length<ie&&r-H>ee)){const t=Math.floor(Math.random()*L.length),y=(p-c)/m,h=Array.from({length:m},(v,R)=>c+R*y+y/2),x=h[Math.floor(Math.random()*h.length)]-L[t].w/2,A=Math.max(c,Math.min(x,p-L[t].w));i.current.every(v=>{const R=Math.abs(v.x-x)<5,b=Math.abs(v.y- -120);return!(R&&b)})&&i.current.push({id:++ae,sprite:L[t],x:A,y:-120,nearMissAwarded:!1}),H=r}i.current.forEach(t=>{t.y+=ce*N}),i.current=i.current.filter(t=>t.y<480),i.current.forEach(t=>{const y=t.sprite.w,h=t.sprite.h,D=t.x+y/2,x=t.y+h/2,A=n.current-u/2,W=n.current+u/2,v=f.current-C/2,R=f.current+C/2,b=D-y/2,B=D+y/2,te=x-h/2,re=x+h/2,G=A<B&&W>b&&v<re&&R>te;G&&!X&&(console.log("Collision detected"),T(!0),g("gameOver"),window.onkeydown=M=>{d[M.key]=!1},window.onkeyup=M=>{d[M.key]=!1});const Y=10,ne=Math.abs(W-b)<Y||Math.abs(B-A)<Y,se=!G&&ne;t.y>0&&se&&!t.nearMissAwarded&&(t.nearMissAwarded=!0,P(M=>M+1))}),l.style.left=n.current-u/2+"px",l.style.top=f.current+"px",z(t=>t+1)},$=r=>{n.current+=r.gamma*.07,n.current=Math.max(c+u/2,Math.min(p-u/2,n.current))};return window.addEventListener("deviceorientation",$),e=requestAnimationFrame(I),()=>{cancelAnimationFrame(e),window.removeEventListener("deviceorientation",$)}},[a,X]);const V=()=>{if(g("playing"),T(!1),P(0),i.current=[],E.current=0,f.current=360,S("idle"),Object.keys(d).forEach(e=>{d[e]=!1}),w.current&&k.current){const e=(p-c)/m,j=c+Math.floor(m/2)*e+e/2;n.current=j,w.current.style.left=n.current-O/2+"px",w.current.style.top=f.current+"px"}};return o.jsx("div",{children:o.jsxs("div",{ref:k,className:"container","data-counter":U,style:{backgroundPosition:`center ${E.current}px`},children:[o.jsx("div",{className:"cars",children:i.current.map(e=>o.jsx("div",{className:"car",style:{width:e.sprite.w,height:e.sprite.h,top:e.y,left:e.x,backgroundPosition:`-${e.sprite.x}px -${e.sprite.y}px`}},e.id))}),o.jsx("div",{className:"player","data-direction":J,ref:w,style:{width:O,height:C,top:f.current+"px",visibility:a==="playing"?"visible":"hidden"}}),o.jsxs("div",{className:"score",children:["Score: ",K]}),a!=="playing"&&o.jsx("div",{className:"overlay",children:o.jsxs("div",{className:"overlay-box",children:[o.jsx("div",{className:"overlay-title",children:a==="gameOver"?"Game Over":"Highway Rush"}),o.jsx("div",{className:"overlay-description",children:a==="gameOver"?"Click Restart to try again":"Use arrow keys <= or =>, to score commit near misses"}),o.jsx("button",{className:"overlay-button",onClick:a==="start"?Q:V,children:a==="start"?"Start":"Restart"})]})})]})})}export{ue as default};
