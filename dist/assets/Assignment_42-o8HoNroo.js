import{r as s,j as o}from"./index-OaU4KI2l.js";const C=86.4,O=45.4,f={},_=3,oe=.375,l=35,m=290,L=[{x:66.8,y:16,w:52,h:92},{x:188.8,y:16,w:48,h:94.8},{x:7,y:192.2,w:52.6,h:136.4},{x:425.2,y:19.8,w:60.1,h:137.3}];let ae=0;const ie=2,ce=.2,g=3;function ue(){const E=s.useRef(0),[U,z]=s.useState(0),w=s.useRef(null),S=s.useRef(null),[J,i]=s.useState(null),c=s.useRef([]),y=s.useRef(360),[X,T]=s.useState(!1),[K,P]=s.useState(0),[a,x]=s.useState("start"),n=s.useRef((S.current?.offsetWidth??0-O)/2),q=s.useRef("idle"),Q=()=>{DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{x(t==="granted"?"playing":"error")}):x("playing")};s.useEffect(()=>{let t=null,j=performance.now(),u=w.current;if(!u||!S.current)return;let d=u.offsetWidth;const F=(m-l)/g,Z=l+Math.floor(g/2)*F+F/2;n.current=Z,u.style.left=n.current-d/2+"px";let H=0,ee=1e3;window.onkeydown=r=>{a==="playing"&&((r.key==="ArrowLeft"||r.key==="ArrowRight")&&r.preventDefault(),f[r.key]=!0)},window.onkeyup=r=>{a==="playing"&&((r.key==="ArrowLeft"||r.key==="ArrowRight")&&r.preventDefault(),f[r.key]=!1)};const I=r=>{t=requestAnimationFrame(I);const N=r-j;if(E.current+=oe*N,j=r,a==="playing"&&(f.ArrowLeft||q.current==="left"?(n.current=Math.max(l+d/2,n.current-_),i("left"),u.style.transform="rotate(-15deg)"):f.ArrowRight||q.current==="right"?(n.current=Math.min(m-d/2,n.current+_),i("right"),u.style.transform="rotate(15deg)"):(i("idle"),u.style.transform="rotate(0deg)"),c.current.length<ie&&r-H>ee)){const e=Math.floor(Math.random()*L.length),h=(m-l)/g,p=Array.from({length:g},(R,M)=>l+M*h+h/2),v=p[Math.floor(Math.random()*p.length)]-L[e].w/2,A=Math.max(l,Math.min(v,m-L[e].w));c.current.every(R=>{const M=Math.abs(R.x-v)<5,b=Math.abs(R.y- -120);return!(M&&b)})&&c.current.push({id:++ae,sprite:L[e],x:A,y:-120,nearMissAwarded:!1}),H=r}c.current.forEach(e=>{e.y+=ce*N}),c.current=c.current.filter(e=>e.y<480),c.current.forEach(e=>{const h=e.sprite.w,p=e.sprite.h,D=e.x+h/2,v=e.y+p/2,A=n.current-d/2,W=n.current+d/2,R=y.current-C/2,M=y.current+C/2,b=D-h/2,B=D+h/2,te=v-p/2,re=v+p/2,G=A<B&&W>b&&R<re&&M>te;G&&!X&&(console.log("Collision detected"),T(!0),x("gameOver"),window.onkeydown=k=>{f[k.key]=!1},window.onkeyup=k=>{f[k.key]=!1});const Y=10,ne=Math.abs(W-b)<Y||Math.abs(B-A)<Y,se=!G&&ne;e.y>0&&se&&!e.nearMissAwarded&&(e.nearMissAwarded=!0,P(k=>k+1))}),u.style.left=n.current-d/2+"px",u.style.top=y.current+"px",z(e=>e+1)},$=r=>{const e=r.gamma;n.current+=e*.07,n.current=Math.max(l+d/2,Math.min(m-d/2,n.current)),e>20||e>5?i("right"):e<-20||e<-5?i("left"):i("idle")};return window.addEventListener("deviceorientation",$),t=requestAnimationFrame(I),()=>{cancelAnimationFrame(t),window.removeEventListener("deviceorientation",$)}},[a,X]);const V=()=>{if(x("playing"),T(!1),P(0),c.current=[],E.current=0,y.current=360,i("idle"),Object.keys(f).forEach(t=>{f[t]=!1}),w.current&&S.current){const t=(m-l)/g,j=l+Math.floor(g/2)*t+t/2;n.current=j,w.current.style.left=n.current-O/2+"px",w.current.style.top=y.current+"px"}};return o.jsx("div",{children:o.jsxs("div",{ref:S,className:"container","data-counter":U,style:{backgroundPosition:`center ${E.current}px`},children:[o.jsx("div",{className:"cars",children:c.current.map(t=>o.jsx("div",{className:"car",style:{width:t.sprite.w,height:t.sprite.h,top:t.y,left:t.x,backgroundPosition:`-${t.sprite.x}px -${t.sprite.y}px`}},t.id))}),o.jsx("div",{className:"player","data-direction":J,ref:w,style:{width:O,height:C,top:y.current+"px",visibility:a==="playing"?"visible":"hidden"}}),o.jsxs("div",{className:"score",children:["Score: ",K]}),a!=="playing"&&o.jsx("div",{className:"overlay",children:o.jsxs("div",{className:"overlay-box",children:[o.jsx("div",{className:"overlay-title",children:a==="gameOver"?"Game Over":"Highway Rush"}),o.jsx("div",{className:"overlay-description",children:a==="gameOver"?"Click Restart to try again":"Use arrow keys <= or =>, to score commit near misses"}),o.jsx("button",{className:"overlay-button",onClick:a==="start"?Q:V,children:a==="start"?"Start":"Restart"})]})})]})})}export{ue as default};
