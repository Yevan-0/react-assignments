import{r as s,j as e}from"./index-vpOG30Fb.js";import{a as k}from"./index-NIGUFBhG.js";function E({setLogged:u}){const[t,c]=s.useState(""),[m,j]=s.useState(""),[p,d]=s.useState(!1),[h,f]=s.useState(!1),[l,r]=s.useState(!1),x=async()=>{d(!0);try{const i=(await k.post("https://auth.dnjs.lk/api/login",{email:t,password:m})).data.access_token;l?(localStorage.setItem("access_token",i),localStorage.setItem("signedin","true")):(sessionStorage.setItem("access_token",i),sessionStorage.setItem("signedin","true")),u(!0),f(!1),localStorage.setItem("access_token",i),console.log(i)}catch(a){d(!1),console.log("Error:",a.response?.data||a.message),f("Login in unsuccessful"),u(!1)}finally{d(!1)}};return s.useEffect(()=>{const a=localStorage.getItem("rememberMe");a!==null&&r(a==="true")},[]),e.jsxs("div",{children:[e.jsx("input",{type:"text",placeholder:"Enter email",value:t,onChange:a=>c(a.target.value),disabled:p}),e.jsx("br",{}),e.jsx("input",{type:"password",placeholder:"Enter password",value:m,onChange:a=>j(a.target.value),disabled:p}),e.jsx("br",{}),e.jsx("p",{onChange:x,children:h}),e.jsxs("span",{children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>{const a=!l;r(a),localStorage.setItem("rememberMe",a)}}),"Keep me logged in"]}),e.jsx("br",{}),e.jsx("button",{onClick:x,style:{margin:"10px",color:"cyan"},disabled:p,children:p?"Loging In...":"Login"})]})}function C({setLogged:u}){const[t,c]=s.useState(null),[m,j]=s.useState(null),[p,d]=s.useState(!1),[h,f]=s.useState(""),[l,r]=s.useState(""),[x,a]=s.useState(!1),[i,S]=s.useState(!1),[b,v]=s.useState(!1);s.useEffect(()=>{const o=localStorage.getItem("access_token")||sessionStorage.getItem("access_token");k.get("https://auth.dnjs.lk/api/user",{headers:{Authorization:`Bearer ${o}`}}).then(n=>{c(n.data),console.log(n.data)}).catch(n=>{j("Failed to fetch data properly"),console.error(n)})},[]);const y=async()=>{const o=localStorage.getItem("access_token")||sessionStorage.getItem("access_token");d(!0);try{await k.post("https://auth.dnjs.lk/api/logout",{},{headers:{Authorization:`Bearer ${o}`}}),localStorage.removeItem("access_token"),localStorage.removeItem("signedin"),sessionStorage.removeItem("access_token"),sessionStorage.removeItem("signedin"),u(!1),console.log("Logout Successful")}catch{console.error("Logout failed")}finally{d(!0)}},g=async()=>{const o=localStorage.getItem("access_token")||sessionStorage.getItem("access_token");a(!0),S(!1);const n={name:h?.trim()===""?t.name:h,description:l??t.description};try{await k.put("https://auth.dnjs.lk/api/user",n,{headers:{Authorization:`Bearer ${o}`}}),a(!0),c(I=>({...I,name:n.name,description:n.description}))}catch(I){console.error("Error:",I)}finally{a(!1)}};return s.useEffect(()=>{t&&(f(o=>o||t.name||""),r(o=>o||t.description||""))},[t]),e.jsx("div",{children:i?e.jsx(_,{name:h,setName:f,description:l,setDescription:r,handleSave:g,loading:x,back:()=>S(!1),setData:c,setHasEdited:v}):e.jsxs("div",{children:[e.jsx("h3",{children:"You have now logged in!"}),e.jsxs("p",{children:["Name: ",t?.name]}),e.jsxs("p",{children:["Email: ",t?.email]}),e.jsx("img",{src:t?.avatar,alt:"User Avatar",style:{borderRadius:"50%",width:"100px",height:"100px",objectFit:"cover"}}),e.jsxs("p",{children:["Subscribed: ",t?.subscribed?"Yes":"No"]}),e.jsxs("p",{children:["Description: ",t?.description]}),e.jsx("button",{onClick:()=>S(!0),style:{margin:"10px",color:"cyan"},children:"Edit Profile"}),e.jsx("br",{}),e.jsx("button",{onClick:y,disabled:p,style:{margin:"10px",color:"red"},children:"Log out"})]})})}function _(u){const{name:t,setName:c,description:m,setDescription:j,handleSave:p,loading:d,back:h,setData:f,setHasEdited:l}=u,[r,x]=s.useState(null),[a,i]=s.useState(!1),[S,b]=s.useState(!1),v=g=>{const o=g.target.files?.[0];o&&o.type.startsWith("image/")?(b(!1),i(!1),x(o)):alert("Select vlaid image file")},y=async()=>{if(!r)return alert("No image selected");const g=localStorage.getItem("access_token")||sessionStorage.getItem("access_token"),o=new FormData;o.append("avatar",r),i(!0),b(!1);try{await k.post("https://auth.dnjs.lk/api/avatar",o,{headers:{Authorization:`Bearer ${g}`,"Content-type":"multipart/form-data"}}),f(n=>({...n,avatar:URL.createObjectURL(r)})),b(!0)}catch(n){console.error("Upload failed",n)}finally{i(!1)}};return e.jsxs("div",{children:[e.jsx("h4",{children:"Edit Your Profile"}),e.jsx("input",{value:t,onChange:g=>{l(!0),c(g.target.value)},type:"text",placeholder:"Change Name"}),e.jsx("br",{}),e.jsx("input",{value:m,onChange:g=>j(g.target.value),type:"text",placeholder:"Change Description",style:{margin:"10px"}}),e.jsx("br",{}),r&&e.jsx("img",{src:URL.createObjectURL(r),alt:"Preview",style:{width:"100px",height:"100px",borderRadius:"50%",objectFit:"cover",margin:"10px"}}),e.jsx("br",{}),e.jsx("input",{type:"file",accept:"image/",onChange:v}),e.jsx("button",{onClick:y,disabled:a||S,children:a?"Uploading...":S?"Uploaded":"Upload"}),e.jsx("br",{}),e.jsx("button",{onClick:p,disabled:d,style:{margin:"10px",color:"chartreuse"},children:d?"Saving...":"Save"}),e.jsx("button",{onClick:h,style:{margin:"10px",color:"cyan"},children:"Go Back"})]})}function U(){const[u,t]=s.useState(!1);return s.useEffect(()=>{const c=localStorage.getItem("access_token")||sessionStorage.getItem("access_token"),m=localStorage.getItem("signedin")||sessionStorage.getItem("signedin");t(!!(c&&m==="true"))},[]),u?e.jsx(C,{setLogged:t}):e.jsx(E,{setLogged:t})}export{U as default};
