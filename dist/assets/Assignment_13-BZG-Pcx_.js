import{r as o,j as e}from"./index-CvFkJeIF.js";import{a as p}from"./index-B9ygI19o.js";function S({setLogged:l}){const[s,g]=o.useState(""),[n,u]=o.useState(""),[c,r]=o.useState(!1),[m,i]=o.useState(!1),[a,h]=o.useState(!1),f=async()=>{r(!0);try{const d=(await p.post("https://auth.dnjs.lk/api/login",{email:s,password:n})).data.access_token;a?(localStorage.setItem("access_token",d),localStorage.setItem("signedin","true")):(sessionStorage.setItem("access_token",d),sessionStorage.setItem("signedin","true")),l(!0),i(!1),localStorage.setItem("access_token",d),console.log(d)}catch(t){r(!1),console.log("Error:",t.response?.data||t.message),i("Login in unsuccessful"),l(!1)}finally{r(!1)}};return o.useEffect(()=>{const t=localStorage.getItem("rememberMe");t!==null&&h(t==="true")},[]),e.jsxs("div",{children:[e.jsx("input",{type:"text",placeholder:"Enter email",value:s,onChange:t=>g(t.target.value),disabled:c}),e.jsx("br",{}),e.jsx("input",{type:"password",placeholder:"Enter password",value:n,onChange:t=>u(t.target.value),disabled:c}),e.jsx("br",{}),e.jsx("p",{onChange:f,children:m}),e.jsxs("span",{children:[e.jsx("input",{type:"checkbox",checked:a,onChange:()=>{const t=!a;h(t),localStorage.setItem("rememberMe",t)}}),"Keep me logged in"]}),e.jsx("br",{}),e.jsx("button",{onClick:f,style:{margin:"10px"},disabled:c,children:"Login"})]})}function x({setLogged:l}){const[s,g]=o.useState(null),[n,u]=o.useState(null),[c,r]=o.useState(!1);o.useEffect(()=>{const i=localStorage.getItem("access_token")||sessionStorage.getItem("access_token");p.get("https://auth.dnjs.lk/api/user",{headers:{Authorization:`Bearer ${i}`}}).then(a=>{g(a.data)}).catch(a=>{u("Failed to fetch data properly"),console.error(a)})},[]);const m=async()=>{const i=localStorage.getItem("access_token")||sessionStorage.getItem("access_token");r(!0);try{await p.post("https://auth.dnjs.lk/api/logout",{},{headers:{Authorization:`Bearer ${i}`}}),r(!0),localStorage.removeItem("access_token"),localStorage.removeItem("signedin"),sessionStorage.removeItem("access_token"),sessionStorage.removeItem("signedin"),l(!1),console.log("Logout Successful")}catch{console.error("Logout failed")}finally{r(!0)}};return e.jsx("div",{children:s?e.jsxs("div",{children:[e.jsx("h3",{children:"You have now logged in!"}),e.jsxs("p",{children:["Name: ",s.name]}),e.jsxs("p",{children:["Email: ",s.email]}),e.jsx("img",{src:s.avatar,alt:"User Avatar",style:{borderRadius:"50%",width:"100px"}}),e.jsxs("p",{children:["Subscribed: ",s.subscribed?"Yes":"No"]}),e.jsx("button",{onClick:m,disabled:c,children:c?"Logging out...":"Logout"})]}):n?e.jsx("p",{children:n}):e.jsx("p",{children:"Loading profile..."})})}function I(){const[l,s]=o.useState(!1);return o.useEffect(()=>{const g=localStorage.getItem("access_token")||sessionStorage.getItem("access_token"),n=localStorage.getItem("signedin")||sessionStorage.getItem("signedin");s(!!(g&&n==="true"))},[]),l?e.jsx(x,{setLogged:s}):e.jsx(S,{setLogged:s})}export{I as default};
