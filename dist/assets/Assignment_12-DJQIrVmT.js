import{r as t,j as s}from"./index-Cusg-GZ3.js";import{a as p}from"./index-B9ygI19o.js";function k(){const[l,x]=t.useState(""),[d,m]=t.useState(""),[j,o]=t.useState(!0),[c,u]=t.useState(!1),[n,f]=t.useState(null),[a,g]=t.useState(""),[i,r]=t.useState(!0),h=async()=>{try{u(!0);const e=await p.post("https://auth.dnjs.lk/api/login",{email:l,password:d});g(e.data.access_token),o(!1)}catch(e){u(!1),console.log("Error:",e.response?.data||e.message),o("Login in unsuccessful")}};t.useEffect(()=>{a&&p.get("https://auth.dnjs.lk/api/user",{headers:{Authorization:`Bearer ${a}`}}).then(e=>{f(e.data)}).catch(e=>{o("Failed to fetch data properly"),console.error(e)})},[a]),t.useEffect(()=>{const e=localStorage.getItem("signedIn")==="true";r(e)},[]);const S=()=>{r(e=>(localStorage.setItem("signedIn",!e),!e))};return t.useEffect(()=>{a&&i&&(localStorage.setItem("access_token",a),localStorage.setItem("signedIn","true"))},[a,i]),t.useEffect(()=>{const e=localStorage.getItem("access_token"),b=localStorage.getItem("signedIn")==="true";e&&b?(g(e),r(!0)):r(!1)},[]),s.jsxs("div",{children:[s.jsx("input",{type:"text",placeholder:"Enter email",value:l,onChange:e=>x(e.target.value),disabled:c}),s.jsx("br",{}),s.jsx("input",{type:"password",placeholder:"Enter password",value:d,onChange:e=>m(e.target.value),disabled:c}),s.jsx("br",{}),s.jsx("p",{onChange:h,children:j}),s.jsxs("span",{children:[s.jsx("input",{type:"checkbox",checked:i,onChange:S}),"Keep me logged in"]}),s.jsx("br",{}),s.jsx("button",{onClick:h,style:{margin:"10px"},disabled:c,children:"Login"}),s.jsx("br",{}),n&&s.jsxs(s.Fragment,{children:[s.jsx("h3",{children:"You have now logged!"}),s.jsxs("p",{children:["Name: ",n.name]}),s.jsx("img",{src:n.avatar,alt:"User Avatar",style:{border:"50%",width:"100px"}}),s.jsxs("p",{children:["Email: ",n.email]}),s.jsxs("p",{children:["Subscribed: ",n.subscribed?"Yes":"No"]}),s.jsx("br",{})]})]})}export{k as default};
